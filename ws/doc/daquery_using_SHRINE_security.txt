Using the SHRINE Security Infrastructure

ASSUMPTIONS
The Daquery system assumes you have an existing Shrine deployment in place.  The Daquery 
security functionality leverages Shrine certificates and firewall rules.  The topics 
listed under Configuration and Connectivity in the Shrine documentation
(https://open.med.harvard.edu/wiki/display/SHRINE/Configuration+and+Connectivity) 
describe deploying Shrine security.  Please reference these documents for more details.

REQUIREMENTS

SHRINE.CONF
As stated above, the Daquery system leverages the existing Shrine configuration.  In
particular, Daquery expects to find a shrine.conf file in this path:

[TOMCAT_HOME]/lib/shrine.conf

The shrine.conf file must comply with the HOCON format.  Daquery queries the keystore 
parameters: file and password.  Both of these settings must be valid for Daquery 
security to work.  Below is an abbreviated sample of the keystore section:

shrine{
...
  keystore {
    file = "shrine.keystore"
    password = "changethisplease"
    privateKeyAlias = "127.0.1.1"
    ...
  }
}

KEYSTORE ALIAS
For HTTPS and SSL to work between sites, the current site's network address must be in
the keystore file (ex: shrine.keystore file).  The network address can be either
the site's IP address or a resolvable hostname.  This link provides more details
regarding Shrine certificate configuration:

https://open.med.harvard.edu/wiki/display/SHRINE/Using+a+Certificate+Authority+for+SHRINE
  
ADDING AN ALIAS
If you need to add a new site to an existing network, you will need to add its certificate
to your keystore file.  After you obtain the certificate, run this command on your 
Daquery site:

keytool -import -v -trustcacerts -alias $ALIAS_NAME -file $CERTIFICATE_FILE 
-keystore $KEYSTORE_FILE  -keypass $KEYSTORE_PASSWORD  -storepass $KEYSTORE_PASSWORD
  
This command updates your existing $KEYSTORE_FILE and adds the new $ALIAS_NAME using
the site's $CERTIFICATE_FILE.  A sample command is shown below:

keytool -import -v -trustcacerts -alias 127.0.1.1 -file 127.0.1.1.cer 
-keystore /opt/shrine/shrine.keystore  -keypass changethisplease  -storepass changethisplease

