<div>
  <table *ngIf="inquiries" class="table table-striped">
    <caption>Inquiries</caption>
    <thead>
      <tr>
        <th>Query Name</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody *ngFor="let inquiry of inquiries">
      <tr>
        <td>{{inquiry.inquiryName}}</td>
        <td>{{inquiry.dataType}}</td>
        <td>
          <button class="btn btn-primary" (click)="onEditClick(inquiry)">View/Edit</button>
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="!inquiries" class="row">
    <div class="col-md-4 col-md-offset-4 text-center">
      <span sytle="margin: auto">Loading inquiries...</span><br />
      <i sytle="margin: auto" class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>
    </div>
  </div>
  <table *ngIf="requests" class="table table-striped">
    <caption>Requests</caption>
    <thead>
      <tr>
        <th>Request</th>
        <th>Type</th>
        <th>Date/Time</th>
      </tr>
    </thead>
    <tbody *ngFor="let requestGroup of (requestGroups | mapValues)">
      <tr>
        <td (click)="requestGroup.active = !requestGroup.active"><i class="fa pointer" [ngClass]="{'fa-plus-square-o': !requestGroup.active, 'fa-minus-square-o': requestGroup.active}"></i> {{ requestGroup.val[0].inquiry.inquiryName }}</td>
        <td>{{ requestGroup.val[0].direction }}</td>
        <td>{{ requestGroup.val[0].responses[0]?.replyTimestamp | amTimeAgo }}</td>
        <td></td>
      </tr>
      <tr *ngIf="requestGroup.active">
        <td colspan="4">
          <p (click)="requestGroup.showingDetails = !requestGroup.showingDetails">Show Details <i class="fa" [ngClass]="{'fa-chevron-circle-down': !requestGroup.showingDetails, 'fa-chevron-circle-up': requestGroup.showingDetails}" aria-hidden="true"></i></p>
          <div *ngIf="requestGroup.showingDetails" class="box box-solid">
            <div class="box-body">
                <form class="form-horizontal">
                    <div>
                      <div class="form-group">
                        <label class="col-sm-2 control-label">Requester</label>
                        <div class="col-sm-10" style="padding-top: 7px">
                          {{ requestGroup.val[0].requester?.realName }}
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-sm-2 control-label">Description</label>
                        <div class="col-sm-10" style="padding-top: 7px">
                          {{ requestGroup.val[0].inquiry.inquiryDescription }}
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-sm-2 control-label">Code</label>
                        <div class="col-sm-10" style="padding-top: 7px">
                          {{ requestGroup.val[0].inquiry.code }}
                        </div>
                      </div>
                    </div>
                  </form>
            </div>
            <!-- /.box-body -->
            </div>
          <table class="table table-condensed table-striped">
            <thead>
              <tr>
                <th>Site</th>
                <th>Status</th>
                <th>Result</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of requestGroup.val">
                <td>{{ request.requestSite.name }}</td>
                <td>{{ request.responses[0]?.status }}</td>
                <td>{{ request.responses[0]?.value }}
                    <i *ngIf="!['ERROR', 'COMPLETED', 'STALLED'].includes(request.responses[0]?.status) && !request.responses[0]?.hasError" class="fa fa-refresh fa-spin fa-1x fa-fw"></i>
                    <span *ngIf="request.responses[0]?.hasError" class="pull-right-container">
                      <small class="label bg-red">Network Error</small>
                    </span>
                </td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="!requests" class="row">
      <div class="col-md-4 col-md-offset-4 text-center">
        <span>Loading requests...</span><br />
        <i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>
      </div>
    </div>
</div>
