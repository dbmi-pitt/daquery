<div *ngIf="requests" class="box box-success">
  <div class="box-header with-border">
    <i class="fa fa-info" aria-hidden="true"></i><h3 class="box-title">Recent Request</h3>
  </div>
  <div class="box-body">
      <form class="form-horizontal">
        <div>
          <div class="form-group">
            <label class="col-sm-2 control-label">Requester</label>
            <div class="col-sm-10" style="padding-top: 7px">
              {{ userService.getCurrentUser().realName }}
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">Description</label>
            <div class="col-sm-10" style="padding-top: 7px">
              {{ requests ? requests[0].inquiry.inquiryDescription : '' }}
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">Code</label>
            <div class="col-sm-10" style="padding-top: 7px">
              {{ requests ? requests[0].inquiry.code : '' }}
            </div>
          </div>
        </div>
      </form>
      <table class="table table-condensed table-striped">
        <thead>
          <tr>
            <th>Site</th>
            <th>Status</th>
            <th>Result</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of requests">
            <td>{{ request?.requestSite.name }}</td>
            <td>{{ request?.response?.status }}</td>
            <td>{{ request?.response?.status === 'ERROR' ? request.response?.errorMessage : request.response?.value }}
                <i *ngIf="!['ERROR', 'COMPLETED', 'STALLED'].includes(request?.response?.status) && !request?.response?.hasError && !request?.error" class="fa fa-circle-o-notch fa-spin fa-1x fa-fw"></i>
                <span *ngIf="request?.response?.hasError" class="pull-right-container">
                  <small class="label bg-red">Network Error</small>
                </span>
                <span *ngIf="request?.error" class="pull-right-container">
                  <small class="label bg-red" data-toggle="tooltip" data-placement="top" [title]="request?.error?.error?.longMessage">{{ request?.error?.error?.displayMessage }}</small>
                </span>
            </td>
            <td>
              <button *ngIf="request.inquiry.queryType === 'AGGREGATE'" [disabled]="!request.response || !request.response.downloadAvailable" class="btn btn-primary btn-xs" (click)="requestData(request)">Request Data</button>
            </td>
          </tr>
        </tbody>
      </table>
  </div>
  <!-- /.box-body -->
</div>